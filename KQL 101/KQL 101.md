# KQL 101

# Section 1: Tables, Ladders and Data

### Question 1

Welcome to KQL 101: Unlocking the Power of Data 🔍⚡

Every security investigation starts with a question. Who accessed that system? Where did that suspicious login come from? What’s causing all of those failed authentication attempts? The answers are hidden in massive amounts of data and that’s where Kusto Query Language (KQL) comes in.

![Data Scrolling](https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExOW90ZmMybWxleWU1amJqNTdlNTYzN3h2a3dlcHdkdXdrMWJneHJzbiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/B4dt6rXq6nABilHTYM/giphy.gif)

KQL is a powerful, easy-to-learn query language designed for fast, flexible data exploration in Azure Data Explorer (ADX). Security analysts, incident responders, threat intelligence analysts, and threat hunters use it every day to:

1. Search logs in seconds—because speed matters when investigating threats
2. Filter and analyze events—cut through the noise and focus on what’s important
3. Identify anomalies and patterns—spot unusual activity before it becomes a bigger problem

**Enter `KQL ftw` to continue.**

### Question 2

In cybersecurity, data is everything. Attackers will leave behind evidence of their actions in authentication logs, network traffic, and process events but if you don’t know how to query and analyze that data efficiently, those clues remain buried. KQL helps you connect the dots, so you can think like an investigator and stay ahead of cyber threats.

![dots](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExanh2M3BicWpxNGp2Zjc0ZjEydm5sMGZ5b21nMnN1djFrNjhhZHh2ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/muyMNiI4N45OU2Jv3T/giphy.gif)

**Enter `uncover the clues` to continue.**

### Question 3

Learning a new language can seem intimidating, but don’t worry. We’ll take it step by step.

We’ll start with the very basics: understanding tables, columns, and values before moving on to writing queries. By the end of this module, you'll be able to:

- 🚀 Navigate and explore datasets
- 🔍 Filter and refine security logs
- 📊 Extract meaningful insights from massive amounts of data
- 🛠 Apply KQL in real-world cybersecurity scenarios

**Enter `show me the data` to continue.**

### Question 4

For this exercise, we'll be looking at security data from Jojo's Hospital.

Data is stored in `tables`, just like in a spreadsheet.

![wwetable](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExbmFmcmczZXJmbG1iZHg0YzU4bzMzenNiNjF3cWRrMnhsaXY4ejYybiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/euniGL7rhtywlWqbjV/giphy.gif)

Each `row` represents an individual record, and each `column` stores a specific type of information or `value`, such as usernames, timestamps, or IP addresses.

Before we start querying, let’s explore the structure of our data. 1️⃣ Exploring Available Tables

Every investigation starts with knowing what data you have.

Click the `Available Tables` tab to see a list of tables.

**Enter `table it up` to contine.**

### Question 5

![image.png](KQL%20101%202557141dc5438097a39ee1d437be67b7/image.png)

Now we should try to understand how to use the data available to us in each table to conduct our investigation.

**Which table would tell us if an employee received a suspicious email?**

> `Email`
> 

### Question 6

**Which table would tell us if they went to their bank website to see how much money they had?**

> `OutboundNetworkEvents`
> 

### Question 7

**Which table would tell us if an employee saved a malicious file on his computer?**

> `FileCreationEvents`
> 

### Question 8

**Which table would tell us if that employee opened that malicious file that was saved on his computer?**

> `ProcessEvents`
> 

### Question 9

**Which table would you look in to see if that malicious file was detected on an employee's machine?**

> `SecurityAlerts`
> 

# Section 2: Rows and Columns: Tag Team Champs of Data

### Question 1

Each table is made up of columns and rows.

📌 Columns store specific types of information, like names, email addresses, or timestamps. 📌 Rows represent individual records in the table. Each row contains a full set of data for a single entry.

Knowing how tables are structured helps us ask the right questions and quickly find the answers we need.

**Enter `row row row` to continue.**

![image.png](KQL%20101%202557141dc5438097a39ee1d437be67b7/image%201.png)

### Question 2

Awesome! You're ready! Let's take our first look 👀 at the data.

Copy and paste the query below into the query pane on the right, and then click `run`.

![Gif showing click to run query](https://nm0g0vqj.tinifycdn.com/gifs/click%20to%20run.gif)

```sql
Employees
| take 10
```

**How many rows of data did that query return?**

> `10`
> 

### Question 3

**What column contains information about an employee's job title?**

> `role`
> 

### Question 4

Each column stores `values`, which are the actual pieces of information inside the table.

For example, if the role column contains job titles, then each job title like Nurse, Surgeon, or Pharmacist is a `value` in that column.

We can query specific values to find the information we need.

```sql
Employees
| where role == "Pharmacist"
```

**How many pharmacists work at our company?**

> `19`
> 

# Section 3: Commands and Operators: The Finishing Moves

### Question 1

In KQL, we use `commands` and `operators` to explore and filter data. Let’s start with a key command called `take`.

`take` grabs a small number of rows to preview data. It’s a useful way to quickly see what’s inside a table without running a large query.

We build our queries by starting with the `Table` name. On the next line, we use a `|` (pipe) followed by our command. The cool thing about KQL is that it will often autofill suggestions as you type.

Let’s try it!

```sql
<Your Table>
| take 10
```

**Do a take 10 on a table of your choice and enter `when in doubt take 10`.**

![take10](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExcXF5ODFwYjRwMjVpdnpkMTgxY3drbmI2azVnMnBiMnh4c3F1M244dyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/iFnBpFxFGetn8BH0vZ/giphy.gif)

### Question 2

In a security investigation, the `count` command is useful for understanding the volume or frequency of certain events, such as how many times a particular **IP address** has accessed a system, how many failed login attempts occurred, or how many times a specific process has run.

This can help you **quickly** identify suspicious activity, detect patterns, and prioritize areas that may require deeper investigation based on abnormal or high activity levels.

**How many employees work at our company?**

> `321`
> 

```sql
Employees
| count
```

### Question 3

The `distinct` command is useful for removing duplicate data so that you're only looking at unique values.

This is especially helpful when analyzing large datasets where repeated entries might clutter your results. Security analysts use `distinct` to:

> `1. Identify unique IP addresses that have accessed **a** system
2. List **all** different usernames that have attempted **to** log in
3. Find the variety of processes running on **a** machine`
> 

For example, if we want to see all the different job roles in an organization:

```sql
Employees
| **distinct** role
```

This helps streamline analysis, making it easier to spot patterns and anomalies without being overwhelmed by redundant data.

**How many distinct employee roles do we have at our company?**

> `23`
> 

### Question 4

The `where` command is essential for narrowing down data to find exactly what you're looking for. Instead of sifting through thousands of logs, `where` helps you filter results based on specific conditions.

For example, if we want to find all employees with the role Radiologist, we can run:

```sql
Employees
| where role == "Radiologist"
```

This makes it easier to focus on relevant data and speed up investigations.

**How many Radiologists with the name Richard do we have at our company?**

> `2`
> 

### Question 5

Now that we know how to filter data using `where`, let’s talk about `operators` which are the tools that help us define what we’re looking for.

The `==` operator is used to find `exact` matches in a column. This is useful when you need to look up a specific thing like a user, IP address, or event.

📌 Important: The `==` operator is case-sensitive, so "Security Analyst" and "security analyst" are treated as different values.

Let’s try it!

```sql
Employees
| where name == "Noemi Tep"
```

Run the query above and find Noemi Tep.

**What is Noemi's email address?**

> `noemi_tep@jojoshospital.org`
> 

### Question 6

Bingo!

In instances where we don’t have an exact value, we can use the `contains` operator instead.

For example, we know we have security staff at our hospital but we can't remember their exact title. Hmm..was it security guard or security person or something? The `contains` operator helps us find it, and it’s not case-sensitive.

```sql
Employees
| **where** role **contains** "security"
```

**What is the name of the exact role?**

> `Security Officer`
> 

### Question 7

Based off a partner tip around a phishing campaign, you start investigating emails related to health policies, looking for messages that mention *health* in the subject line.

You decide to use `contains` to find any subject that includes the word *health*.But now you're drowning in results! 😵‍💫

Along with emails about health benefits, you’re also pulling in:

- ❌ "Healthcare Plan Changes" (Too broad!)
- ❌ "Stay Healthy This Winter" (Not what we wanted!)

Since `contains` finds anywhere the word appears, it’s catching results where *health* is just part of a larger word, like *healthy* or *healthcare* , which isn't what you're looking for.In cases like this, we can use has, which only finds "health" when it appears as a standalone word in the subject line.

```sql
Email
| where subject has "health"
```

- ✅ "Health Benefits Update" (Correct!)
- ❌ "Healthcare Plan Changes" (Excluded!)
- ❌ "Stay Healthy This Winter" (Excluded!)

By using has, we focus only on emails where *health* is an independent word, avoiding false positives and making the investigation more precise.

**How many emails did we receive that have the word *health* in the subject?**

> `613`
> 

### Question 8

Sometimes, we want to filter out certain values instead of finding them. That’s where the `!contains` operator comes in.

While `contains` helps us find values that include a keyword, `!contains` excludes anything that matches.

Let’s say we’re investigating emails sent to Noemi Tep, but we only want to see messages from external senders. We can use `!contains` to exclude any sender from within jojoshospital.org.

```sql
Email
| **where** recipient == "noemi_tep@jojoshospital.org"
| **where** sender !**contains** "jojoshospital"
```

This ensures that any email sent from within our organization is removed, leaving us only with messages from external domains.

**Who is the sender for the last external email received by Noemi?**

> `skirmishes.converts@yandex.com`
> 

```sql
Email
| where recipient == "noemi_tep@jojoshospital.org"
| where sender !contains "jojoshospital"
| sort by timestamp desc //last mail
```

### Question 9

We might also want to filter our data using multiple conditions at once. The `and` operator allows us to narrow down results by requiring that all conditions are true.

Let’s say we are analyzing login attempts and want to find only failed logins from a specific IP address. We can use `and` to combine both conditions:

```sql
AuthenticationEvents
| **where** src_ip == "10.10.0.144" **and** **result** == "Failed Login"
| count
```

**How many failed login attempts were there from this IP address?**

> `59`
> 

### Question 10

While `and` narrows down results by requiring multiple conditions to are true, `or` broadens them by allowing multiple possibilities.

Let’s say we want to see all logins from from two seperate IP addresses.

- 10.10.0.144
- 10.10.0.86

Instead of running two separate queries, we can use `or` to check for both in one search

**How many results do we get in AuthenticationEvents for these two IP addresses?**

> `131`
> 

```sql
AuthenticationEvents
| where src_ip == "10.10.0.144" or src_ip == "10.10.0.86"
| count
```

### Question 11

Now that we’ve covered `or`, we can introduce `in`, which makes searching for multiple values cleaner and more efficient. Instead of writing multiple `or` conditions, we can use `in` to simplify our queries.

Let’s say we want to look at 5 addresses this time. Instead of writing:

```sql
AuthenticationEvents
| where src_ip == "10.10.0.144"  
or src_ip == "10.10.0.86"  
or src_ip == "10.10.0.86"  
or src_ip == "10.10.0.20"  
or src_ip == "10.10.0.109"
```

We can simplify this using `in`. We use the parentheses here to turn the IPs into a list.

```sql
AuthenticationEvents
| where src_ip **in** ("10.10.0.144", "10.10.0.86", "10.10.0.86", "10.10.0.20", "10.10.0.109")
```

**How many `failed` login attempts were from these IP addresses?**

> `169`
> 

```sql
AuthenticationEvents
| where src_ip in ("10.10.0.144", "10.10.0.86", "10.10.0.86", "10.10.0.20", "10.10.0.109") and result has "failed"
| count 
```

### Question 12

In an investigation, data is rarely in one place. You’ll need to `pivot` by taking information from one table and using it in another to uncover the full story.

![pivot](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXd5aTJoenZtYWh6ZjVnc3BpZDFjZmV3bTA2NTZsZ2swd3h2N2s4eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3oz8xQYqSFkvN2n1gk/giphy.gif)

Let’s say we suspect Nancy Roberts has been accessing unauthorized websites. We can’t search for websites directly under her name, but we can find her IP address in the Employees table and use it to track her activity in the OutboundNetworkEvents table.

Think of this as connecting the dots between different sources of data.

Step 1: First, we need to find Nancy's IP address.

```sql
Employees
| where <field> == "Nancy Roberts"
```

Step 2: Now, we use that IP address to check her browsing activity.

```sql
OutboundNetworkEvents
| **where** src_ip == "<Nancy Robert's IP>"
| **distinct** <field>
```

**How many distinct websites(urls) did Nancy Roberts visit?**

> `80`
> 

```sql
Employees
| where name == "Nancy Roberts" 
// Copy source IP '10.10.0.30'

OutboundNetworkEvents
| where src_ip == "10.10.0.30"
| distinct url
| count 
```

### Question 13

When running multiple queries, it’s useful to take notes directly in the ADX query pane so you don’t have to rerun the same commands over and over.

In KQL, you can add comments using `//`. Anything written after `//` is ignored when the query runs, so you can use it to document findings or remind yourself what a query does.

```sql
// Finding Nancy Roberts' IP address to check web browsing
Employees
| **where** name == "Nancy Roberts"
//Nancy's ip address: 10.10.0.30
```

**Enter `//noted` to continue.**

### Question 14

A great feature of ADX is that you can keep multiple queries in the same pane without needing to open new tabs or windows. Instead of running queries one at a time and losing track, you can stack them in one place, separated by a blank line, and run them individually when needed.

To run a specific query, just highlight the one you want and click `Run`.

```sql
// Find all IT support employees
Employees
| **where** role contains "IT support"

// Look for logins from IPs used by IT support 
AuthenticationEvents
| **where** src_ip **in** ("10.10.0.75", "10.10.0.42", "10.10.0.34", "10.10.0.10", "10.10.0.2")

// Count all failed logins
AuthenticationEvents
| **where** result == "Failed Login"
| count
```

Unlike some other platforms, where you might need to open multiple search tabs, ADX lets you keep everything in one view and quickly switch between queries without copying and pasting.

**Enter `rhymes with junk` to continue.**

### Question 15

When working with large investigations, you might need to filter results by multiple values like a list of IP addresses, usernames, or file hashes. Instead of manually writing out a long `in` statement, you can use `let` to store multiple values in a variable and reference them later.

Let's say we want to find out how many websites were visited by employees whose first name is "Mary." We can use let to store their IP addresses and use them in another query.

```sql
**let** mary_ips = 
Employees
| **where** name has "Employee Name"
| **distinct** ip_addr;
OutboundNetworkEvents
| **where** src_ip **in** (mary_ips)
```

Confused? 😵‍💫 Don't worry! Here's a simple breakdown of what's happening:

1. We use a ``let`` statement to create a temporary variable called ``mary_ips``.
2. This variable stores the ``IP addresses`` of employees whose name contains "`Mary`" (found in the ``Employees`` table).
3. We then use ``mary_ips`` to filter the ``OutboundNetworkEvents`` table, checking how many websites those employees visited.

This method makes queries cleaner, more readable, and easier to manage, especially when working with large sets of values.

**How many websites did employees with the first name `Mary` visit?**

> `668`
> 

### Question 16

`Let` statements can be tricky, so let's try it again.

**How many authentication attempts did we see to the accounts of employees with the first name Mary?**

> `810`
> 

```sql
let attempts = Employees
| where name has "Mary"
| distinct username;
AuthenticationEvents
| where username in (attempts)
| count 
```

### Question 17

Congratulations! 🎉 You've Completed KQL 101!

![congrats](https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExZjZzYnhwcjJ5NnZ5aXBhbXh6bnFzMzhqMmh1M3V1eW9hN3FyYjZuYSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/K3raI0cXTkzNC/giphy.gif)

You’ve learned how to:

- ✅ **Navigate tables, columns, and rows** to understand how data is structured
- ✅ **Use filtering commands** like `where`, `contains`, `in`, and `!contains` to find exactly what you need
- ✅ **Apply operators** like `==`, `!=`, `has`, and `and/or` to refine searches
- ✅ **Use `let` to store values** and make complex queries easier to manage

These skills will help you analyze data like a pro! You're now prepared to investigate attacks, hunt for threat actors, and disrupt their operations before they know what hit them.

If you want to learn more about KQL, here are some resources we recommend:

- [10 Minute KQL Youtube channel](https://www.youtube.com/@TenMinuteKQL)
- [The Definitive Guide to KQL book](https://www.amazon.com/Definitive-Guide-KQL-operations-defending/dp/0138293384/ref=asc_df_0138293384?mcid=e852a4f5fc2e342d89ada1cee33a7bb4&hvocijid=14962273819108940280-0138293384-&hvexpln=73&tag=hyprod-20&linkCode=df0&hvadid=730432682330&hvpos=&hvnetw=g&hvrand=14962273819108940280&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9007761&hvtargid=pla-2281435181418&psc=1)
- Play lots of KC7

**Enter `threat actors fear me` to complete this module.**